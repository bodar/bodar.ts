<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todos - Dataflow Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="todo.css">
</head>
<body>

<header class="intro">
    <h1>Dataflow Todos</h1>
    <p>This is a port of the <a href="https://mdn.github.io/todo-react/">MDN React Todo App</a>, rebuilt using Dataflow.</p>

    <p>The entire app is a <strong>single HTML file</strong> (~12KB / 4KB gzipped) plus a small stylesheet (~5KB / 1KB gzipped). Compare this to the React version which weighs in at ~150KB / 50KB gzipped.</p>

    <p><a href="https://github.com/bodar/bodar.ts/blob/master/packages/dataflow/docs/examples/todo.html">View source on GitHub</a> | <a href="../index.html">&larr; Back to Dataflow docs</a></p>
</header>

<div class="todo-app">
    <h1>Todos</h1>

    <script type="module" data-reactive>
        import {display, Mutable} from "@bodar/dataflow/runtime.ts";

        const todos = new Mutable([
            {id: "todo-0", name: "Eat", completed: true},
            {id: "todo-1", name: "Sleep", completed: false},
            {id: "todo-2", name: "Repeat", completed: false},
        ]);
        const addTodo = (name) => todos.update(values => {
            values.push({id: `todo-${values.length}`, name, completed: false});
            return values.slice();
        });
        const deleteTodo = (id) => todos.update(values => values.filter(v => v.id !== id));
        const updateTodo = (todo) => todos.update(values => values.map(v => v.id === todo.id ? todo : v));
    </script>

    <script type="module" data-reactive>
        <form class="todo-form" onsubmit={(e) => { e.preventDefault(); addTodo(document.getElementById('todo-name').value); e.target.reset(); }}>
            <input type="text" id="todo-name" placeholder="What needs to be done?"/>
            <button type="submit" class="btn-icon add" title="Add">+</button>
        </form>
    </script>

    <script type="module" data-reactive>
        const filter = new Mutable(v => v);
        display(<div class="filters">
            <label><input type="radio" name="todo-filter" value="all" checked={true} onchange={() => filter.value = v => v}/><span>All</span></label>
            <label><input type="radio" name="todo-filter" value="active" onchange={() => filter.value = v => !v.completed}/><span>Active</span></label>
            <label><input type="radio" name="todo-filter" value="completed" onchange={() => filter.value = v => v.completed}/><span>Completed</span></label>
        </div>)
    </script>

    <script type="module" data-reactive>
        const filtered = todos.filter(filter)

        display(<p class="task-count">{filtered.length} task{filtered.length !== 1 ? 's' : ''} remaining</p>);
        display(<div class="todo-list">
            {filtered.map(todo => todo.editing ?
                <div class="edit-form">
                    <input type="text" id={`${todo.id}.name`} value={todo.name} placeholder="New name"/>
                    <div class="edit-actions">
                        <button type="button" class="btn-icon cancel" title="Cancel" onclick={() => updateTodo({...todo, editing: false})}>↩</button>
                        <button type="button" class="btn-icon save" title="Save" onclick={() => updateTodo({...todo, name: document.getElementById(`${todo.id}.name`).value, editing: false})}>✓</button>
                    </div>
                </div>
                :
                <div class={`todo-item ${todo.completed ? 'completed' : ''}`}>
                    <input type="checkbox" checked={todo.completed} onclick={() => updateTodo({...todo, completed: !todo.completed})}/>
                    <span class="todo-name">{todo.name}</span>
                    <div class="todo-actions">
                        <button type="button" class="btn-icon delete" title="Delete" onclick={() => deleteTodo(todo.id)}>✕</button>
                        <button type="button" class="btn-icon" title="Edit" onclick={() => updateTodo({...todo, editing: true})}>✎</button>
                    </div>
                </div>
            )}
        </div>);
    </script>

</div>

</body>
</html>
