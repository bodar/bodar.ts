<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todos - Dataflow Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="todo.css">
</head>
<body>

<div class="site-header">
    <h1>Dataflow</h1>
    <a href="https://github.com/bodar/bodar.ts/tree/master/packages/dataflow"><img alt="GitHub" src="https://img.shields.io/badge/github-repo-blue?logo=github"></a>
</div>

<nav class="docs-nav">
    <a href="../index.html">Quick Start</a>
    <a href="../reactivity.html">Reactivity</a>
    <a href="../inputs.html">Inputs</a>
    <a href="../islands.html">Islands</a>
    <a href="./" class="active">Examples</a>
</nav>

<div class="intro">
    <h2>Todo App</h2>
    <p>This is a port of the <a href="https://mdn.github.io/todo-react/">MDN React Todo App</a>, rebuilt using Dataflow.</p>

    <p>The entire app is a <strong>single HTML file</strong> 66 lines of code (~12KB / 4KB gzipped) plus a small stylesheet (~5KB / 1KB gzipped). Compare this to the React version which weighs in at 300 lines of code / ~150KB bundle / 50KB gzipped.</p>

    <p>That is 80% less code and 90% less runtime</p>

    <p><a href="https://github.com/bodar/bodar.ts/blob/master/packages/dataflow/docs/examples/todo.html">View source on GitHub</a></p>
</div>

<div class="todo-app">
    <h1>Todos</h1>

    <script type="module" is="reactive">
        import {display, mutable} from "@bodar/dataflow/runtime.ts";

        const todos = mutable([
            {id: "todo-0", name: "Eat", completed: true},
            {id: "todo-1", name: "Sleep", completed: false},
            {id: "todo-2", name: "Repeat", completed: false},
        ]);
        const addTodo = (name) => todos.update(values => {
            values.push({id: `todo-${crypto.randomUUID()}`, name, completed: false});
            return values;
        });
        const deleteTodo = (id) => todos.update(values => values.filter(v => v.id !== id));
        const updateTodo = (todo) => todos.update(values => values.map(v => v.id === todo.id ? todo : v));
    </script>

    <script type="module" is="reactive">
        <form class="todo-form" onsubmit={(e) => { e.preventDefault(); addTodo(document.getElementById('todo-name').value); e.target.reset(); }}>
            <input type="text" id="todo-name" placeholder="What needs to be done?" required/>
            <button type="submit" class="btn-icon add" title="Add">+</button>
        </form>
    </script>

    <script type="module" is="reactive">
        const filter = mutable(v => v);
        display(<div class="filters">
            <label><input type="radio" name="todo-filter" value="all" checked={true} onchange={() => filter.value = v => v}/><span>All</span></label>
            <label><input type="radio" name="todo-filter" value="active" onchange={() => filter.value = v => !v.completed}/><span>Active</span></label>
            <label><input type="radio" name="todo-filter" value="completed" onchange={() => filter.value = v => v.completed}/><span>Completed</span></label>
        </div>)
    </script>

    <script type="module" is="reactive">
        const filtered = todos.filter(filter)

        display(<p class="task-count">{filtered.length} task{filtered.length !== 1 ? 's' : ''} remaining</p>);
        display(<div class="todo-list">
            {filtered.map(todo =>
                <div class={`todo-item ${todo.completed ? 'completed' : ''}`}>
                    <input type="checkbox" checked={todo.completed} onclick={() => updateTodo({...todo, completed: !todo.completed, name: document.getElementById(`${todo.id}.name`).innerText})}/>
                    <span id={`${todo.id}.name`} class="todo-name" contenteditable="plaintext-only" onblur={(e) => updateTodo({...todo, name: document.getElementById(`${todo.id}.name`).innerText})}>{todo.name}</span>
                    <div class="todo-actions">
                        <button type="button" class="btn-icon delete" title="Delete" onclick={() => deleteTodo(todo.id)}>âœ•</button>
                    </div>
                </div>
            )}
        </div>);
    </script>

</div>

</body>
</html>
