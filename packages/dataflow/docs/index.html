<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dataflow Quick Start</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Dataflow <a href="https://github.com/bodar/bodar.ts/tree/master/packages/dataflow"><img alt="logo: GitHub"
                                                                                            src="https://img.shields.io/badge/github-repo-blue?logo=github"></a>
</h1>

<p>Dataflow is a lightweight reactive JavaScript library heavily inspired by <a
        href="https://observablehq.com/framework/">Observable
    Framework</a>. It brings reactive programming to plain HTML pages with minimal overhead - the core library
    (including JSX support) is under 3KB compressed!</p>

<p>Just add a single <code>data-reactive</code> attribute to any script tag and it becomes reactive. That's it.</p>

<p>It works like a spreadsheet: just reference a value from another reactive script tag, and the plumbing happens
    automatically. No setState, no Redux, no reducers, no signals, no manual subscriptions. Just declarative
    dependencies.</p>

<p>Document order does not matter, all reactive scripts will be topologically sorted and turned into a DAG before
    execution.</p>

<div class="tip">The transformation can happen at build time, at runtime on the server, at the edge, or even client-side
    using a service worker.
</div>

<h2>Example</h2>

<p>A live clock using a generator that yields the current time:</p>


<div class="example">
    <script type="module" data-reactive data-echo="html">
        `The current time is ${new Date(now).toLocaleTimeString("en-GB")}.`
    </script>
    <script type="module" data-reactive>
        let count = 0;
        const counter = function* () {
            while (true) {
                yield count++;
            }
        }
    </script>
    <script type="module" data-reactive>
        if (typeof gc === 'function') gc();
        const baseline = performance.memory?.usedJSHeapSize || 0;
    </script>
    <script type="module" data-reactive>
        {
            if (typeof gc === 'function') gc();
            const current = performance.memory?.usedJSHeapSize || 0;
            const growth = current - baseline;
            display(`Iterations: ${counter} | Heap: ${(current / 1024 / 1024).toFixed(2)} MB | Growth:  ${(growth / 1024 / 1024).toFixed(2)} MB | GC: ${(typeof gc === 'function') ? 'forced' : 'no'}`);
        }
    </script>
</div>

<h2>Expressions and Display</h2>

<p>A single expression automatically displays its result:</p>

<div class="example">
    <script type="module" data-reactive data-echo="html">1 + 2</script>
</div>

<div class="note">
    <strong>Note:</strong> Unlike Observable, a semicolon on the end of a single expression does not change how it
    behaves.
    A single expression is always a singles expression regardless of optional semicolons. Prettier will not break
    anything.
</div>

<p>Statements like variable declarations don't display anything - they just define values for other blocks to use:</p>

<div class="example">
    <script type="module" data-reactive data-echo="html">const foo = 1 + 2;</script>
    <p>The variable <code>foo</code> is defined but nothing is displayed.</p>
</div>


<p>For explicit control, import the <code>display</code> function. You can call it multiple times:</p>

<div class="example">
    <script type="module" data-reactive data-echo="html">
        for (let i = 0; i < 5; ++i) {
            display(i);
        }
    </script>
</div>

<h2>Imports</h2>

<p>Any import in a reactive script is available to all other reactive scripts. So the imported display function is now
    available
    (document order does not matter)</p>

<div class="example">
    <script type="module" data-reactive data-echo="html">
        import {display, view, input} from '@bodar/dataflow/runtime.ts';
    </script>
</div>

<div class="note">
    <strong>Note:</strong> Unlike Observable you do need to import <code>display</code>, <code>view</code>,
    <code>input</code> etc at least once if you want to use them.
</div>

<div class="example">
    <script type="module" data-reactive data-echo="html">
        display('Using previously imported display function');
    </script>
</div>

<div class="note">
    <strong>Note:</strong> All the examples from now on will not show the enclosing reactive script tag
</div>

<h2>DOM Nodes</h2>

<p>If an expression evaluates to a DOM node, the node is inserted into the page. Use this to create dynamic content.</p>

<div class="example">
    <script type="module" data-reactive data-echo>document.createTextNode("[insert chart here]")</script>
</div>

<h2>JSX</h2>

<p>JSX is supported for creating DOM elements with a familiar syntax. Under the hood, JSX compiles directly to native
    DOM methods using the <a href="https://jsr.io/@bodar/jsx2dom">@bodar/jsx2dom</a> library - no virtual DOM, no
    framework overhead.</p>

<p>For example, here's a component that displays a greeting:</p>

<div class="example">
    <script type="module" data-reactive data-echo>
        const greeting = (name) => <i>Hello {name}!</i>
    </script>
    <script type="module" data-reactive data-echo>greeting("World")</script>
</div>

<p>JSX attributes work as expected, including dynamic values:</p>

<div class="example">
    <script type="module" data-reactive data-echo>
        const color = "blue";
    </script>
    <script type="module" data-reactive data-echo>
        <span style={`color: ${color}; font-weight: bold`}>Styled with JSX</span>
    </script>
</div>

<h2>Reactivity with Generators</h2>

<p>Code blocks automatically re-run when referenced reactive variables change. The block below references a
    <code>now</code> variable representing the current time in milliseconds; because <code>now</code> is reactive
    (defined as a generator), this block runs continuously.</p>

<div class="example">
    <script type="module" data-reactive data-echo>
        const now = function* () {
            while (true) {
                yield Date.now();
            }
        }
    </script>
    <script type="module" data-reactive data-echo><span
        style={`color: hsl(${(now / 10) % 360} 100% 50%)`}>Rainbow text!</span></script>
</div>

<h2>Reactive Inputs with view()</h2>

<p>The <code>view</code> function combines <code>display</code> and <code>input</code> to create reactive inputs. When
    the input changes, dependent code re-runs.</p>

<h3>Using Plain JSX Inputs</h3>

<div class="example">
    <script type="module" data-reactive data-echo>
        const name = view(<input name="name" type="text" value="World"/>);
    </script>
    <script type="module" data-reactive data-echo>`Hello, ${name}!`</script>
</div>

<h3>Using Observable Inputs</h3>

<p>You can also use the <code>@observablehq/inputs</code> library for more sophisticated input controls.</p>

<div class="example">
    <script type="module" data-reactive data-echo>
        import {range} from "@observablehq/inputs";

        const slider = view(range([0, 100], {label: "Value", step: 1, value: 50}));
    </script>
    <script type="module" data-reactive data-echo>`The slider value is: ${slider}`</script>
</div>

<h3>Multiple Inputs</h3>

<div class="example">
    <script type="module" data-reactive data-echo>
        const a = view(<input type="number" value="10" style="width: 60px"/>);
    </script>
    <script type="module" data-reactive data-echo>
        const b = view(<input type="number" value="5" style="width: 60px"/>);
    </script>
    <script type="module" data-reactive data-echo>
        <span>{a} + {b} = {a + b}</span>
    </script>
</div>

<h2>Different Input Types</h2>

<h3>Checkbox</h3>

<div class="example">
    <script type="module" data-reactive data-echo>
        const checked = view(<input type="checkbox" id="feature"/>);
    </script>
    <label for="feature">
        <script type="module" data-reactive data-echo>`Feature is ${checked ? 'enabled' : 'disabled'}`</script>
    </label>
</div>

<h3>Select</h3>

<div class="example">
    <script type="module" data-reactive data-echo>
        const color1 = view(<select>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
        </select>);
    </script>
    <script type="module" data-reactive data-echo>
        <span style={`color: ${color1}; font-weight: bold`}>Selected color: {color1}</span>
    </script>
</div>

<h2>Combining Multiple Reactive Values</h2>

<p>Reactive values can depend on multiple inputs. The dependent code re-runs whenever any input changes.</p>

<div class="example">
    <script type="module" data-reactive data-echo>
        const width = view(<input type="range" min="50" max="300" value="150"/>);
    </script>
    <script type="module" data-reactive data-echo>
        const height = view(<input type="range" min="50" max="200" value="100"/>);
    </script>
    <script type="module" data-reactive data-echo>
        const color2 = view(<input type="color" value="#4a90d9"/>);
    </script>
    <script type="module" data-reactive data-echo>
        <div style={`width: ${width}px; height: ${height}px; background: ${color2};
    display: flex; align-items: center; justify-content: center; color: white;
    text-shadow: 1px 1px 2px black`}>
            {width} x {height}
        </div>
    </script>
</div>


<h2>Examples</h2>

<ul>
    <li><a href="examples/todo.html"><strong>Todo App</strong></a> - A port of the <a
            href="https://mdn.github.io/todo-react/">MDN React Todo App</a>. ~17KB total (~5KB gzipped) vs React's
        ~150KB (~50KB gzipped).
    </li>
</ul>

<script type="importmap">
    {
        "imports": {
            "highlight.js/": "https://esm.run/highlight.js/"
        }
    }
</script>
<script type="module">
    import hljs from 'highlight.js/lib/core.js';
    import javascript from 'highlight.js/lib/languages/javascript';
    import xml from 'highlight.js/lib/languages/xml';

    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = "https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/styles/intellij-light.min.css";
    document.head.appendChild(link);
    hljs.registerLanguage('javascript', javascript);
    hljs.registerLanguage('xml', xml);
    hljs.highlightAll();
</script>

</body>
</html>
